<div class="container">
<div class="row">
  <h1 id="browsing">METADATA</h1>
</div>
<div class="row">
  <h4>The button below will show you everything on the shared dropbox for the Menu <%= "#{Rails.env}" %> server.
    Select the files you want to import from <%= "#{@filesystem_location}" %> and click submit.
</h4>

  <form id="myForm" name="myForm"></form>
  <button type="button" class="btn btn-large btn-success" id="browse">Browse!</button>

  <h4 class="success">
    The files should be viewable on Menu's main page shortly. Check your email - you'll receive a message with the results of your import.
  </h4>
  <h4 class="failure">
    We're sorry, something went wrong. Please try again or contact the support team.
  </h4>
</div>

<script>
$().ready(function() {
    $.ajaxSetup({
      headers: {
        'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
      }
    });
  $('#browse').browseEverything({
    route: "/browse",
    target: "#myForm"
    }).done(function(data){
      $.post('/jobs/import', {'file_list': data}, function(){ $("h4.success").show(); }).fail(function() {
        $("h4.failure").show();
  })
    }).cancel(function() {
    // User cancelled the browse operation
    }).fail(function(status, error, text) {
    // URL retrieval experienced a techical failure
    });
});
</script>
</div>